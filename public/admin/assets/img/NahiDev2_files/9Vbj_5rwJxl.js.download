;/*FB_PKG_DELIM*/

__d("LSHandleRepliesOnMessageEdit",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.createArray(),c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]}),function(a){a=a.item;return d[4]=(d[0].push(a.messageId),d[0])})},function(e){return d[1]=c.i64.of_int32(d[0].length),(c.i64.eq(d[1],c.i64.cast([0,0]))?!0:!1)?c.resolve():c.sequence([function(e){return d[4]=new c.Map(),d[4].set("thread_key",a[0]),d[4].set("message_id",a[1]),d[4].set("reply_message_ids",d[0]),d[5]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),"update_replies_on_message_edit",c.i64.cast([0,753]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(e){return d[6]=new c.Map(),d[6].set("thread_key",a[0]),d[6].set("message_id",a[1]),d[6].set("bump_message_ids",d[0]),d[7]=c.toJSON(d[6]),c.storedProcedure(b("LSIssueNewTask"),"update_bump_messages_on_message_edit",c.i64.cast([0,757]),d[7],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(b){return c.db.table(12).fetch([[[a[1]]],"messageId"]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.subthreadKey)})},function(a){return c.i64.neq(d[2],void 0)?c.forEach(c.db.table(9).fetch([[[d[2]]]]),function(a){return a["delete"]()}):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxHandleRepliesOnMessageEditStoredProcedure";a.__tables__=["messages","threads"];e.exports=a}),null);
__d("LSSetSuggestedModerationActions",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return a[1]===b.messageId&&c.i64.eq(a[0],b.threadKey)}).next().then(function(a,e){var f=a.done;a=a.value;return f?d[0]=void 0:(e=a.item,c.sequence([function(a){return d[6]=e.metadataDataclass,d[6]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[8]=new c.Map(),d[9]=d[7].keys(),d[10]=c.i64.of_int32(d[9].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.loopAsync(d[10],function(a){return d[11]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[11]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return d[14]=d[7].get(d[12]),d[8].set(d[12],d[14])}])}):c.resolve()},function(a){return d[5]=d[8]}]):c.resolve((d[7]=new c.Map(),d[5]=d[7]))},function(a){return d[0]=d[5]}]))})},function(b){return d[0]?d[2]=!1:d[2]=!0,d[2]?0:(d[5]=new c.Map(),d[5].set("suggested_moderation_actions_json",a[3]),d[0].set("suggested_moderation_actions",d[5])),d[0]?d[3]=!1:d[3]=!0,d[3]?d[4]=void 0:(d[5]=c.toJSON(d[0]),d[4]=d[5]),c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"messageId"]),function(b){return a[1]===b.messageId&&c.i64.eq(a[0],b.threadKey)}),function(a){var b=a.update;a.item;return b({metadataDataclass:d[4]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxSetSuggestedModerationActionsStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSUpdateMessageTranslationInfo",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.filter(c.db.table(12).fetch([[[a[0]]],"messageId"]),function(b){return a[0]===b.messageId&&c.i64.eq(a[1],b.threadKey)}).next().then(function(a,e){var f=a.done;a=a.value;return f?d[0]=void 0:(e=a.item,c.sequence([function(a){return d[6]=e.metadataDataclass,d[6]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[8]=new c.Map(),d[9]=d[7].keys(),d[10]=c.i64.of_int32(d[9].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.loopAsync(d[10],function(a){return d[11]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[11]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return d[14]=d[7].get(d[12]),d[8].set(d[12],d[14])}])}):c.resolve()},function(a){return d[5]=d[8]}]):c.resolve((d[7]=new c.Map(),d[5]=d[7]))},function(a){return d[0]=d[5]}]))})},function(b){return d[0]?d[2]=!1:d[2]=!0,d[2]?0:(d[5]=new c.Map(),d[5].set("translated_text",a[2]),d[5].set("translated_text_dialect",a[3]),d[0].set("text_translation",d[5])),d[0]?d[3]=!1:d[3]=!0,d[3]?d[4]=void 0:(d[5]=c.toJSON(d[0]),d[4]=d[5]),c.forEach(c.db.table(12).fetch([[[a[0]]],"messageId"]),function(b){var c=b.update;b.item;return c({translatedText:a[2],translatedTextDialect:a[3],metadataDataclass:d[4]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateMessageTranslationInfoStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);