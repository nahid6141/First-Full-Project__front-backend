;/*FB_PKG_DELIM*/

__d("MediaUploadFBCryptoJSHasher",["CryptoJS","MediaUploadTime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){b=b.currentTimeProvider;this.$2=a;this.$1=b}var b=a.prototype;b.$3=function(){switch(this.$2.hashingAlgorithm){case"sha256":return c("CryptoJS").algo.SHA256;case"md5":return c("CryptoJS").algo.MD5;default:return null}};b.$4=function(){switch(this.$2.outputEncoding){case"base64":return c("CryptoJS").enc.Base64;case"hex":return c("CryptoJS").enc.Hex;default:return null}};b.$5=function(a,b,c){return new Promise(function(d){var e=new FileReader();e.onload=function(){e.result instanceof ArrayBuffer?d({isSuccess:!0,data:e.result}):d({isSuccess:!1,rawErrorCode:"INVALID_TYPE_FILE_READER"})};e.onerror=function(){d({isSuccess:!1,rawErrorObject:e.error})};e.readAsArrayBuffer(a.slice(b,b+c))})};b.$6=async function(a,b){var d=this.$2.takeFirstBytes==null?a.size:Math.min(this.$2.takeFirstBytes,a.size),e=0;while(e<d){var f=Math.min(this.$2.maxChunkSize,d-e),g=await this.$5(a,e,f);if(g.isSuccess)b.update(c("CryptoJS").lib.WordArray.create(g.data));else return g;e+=f}return null};b.hash=async function(a){if(this.$2.maxFileSize!=null&&a.size>this.$2.maxFileSize)return{outcome:"FILE_TOO_LARGE"};var b=this.$3();if(b==null)return{outcome:"FAILURE",rawErrorCode:"INVALID_ALGORITHM"};var c=this.$4();if(c==null)return{outcome:"FAILURE",rawErrorCode:"UNSUPPORTED_OUTPUT_ENCODING"};var e=this.$1();b=b.create();try{a=await this.$6(a,b);if(a==null||a.isSuccess)return{outcome:"SUCCESS",value:{algorithm:this.$2.hashingAlgorithm,hashValue:b.finalize().toString(c),encoding:this.$2.outputEncoding,calculationTimeCost:d("MediaUploadTime").subtractTime(this.$1(),e)}};else{return{outcome:"FAILURE",rawErrorCode:(b=a==null?void 0:a.rawErrorCode)!=null?b:"INTERNAL_ERROR",rawErrorObject:a==null?void 0:a.rawErrorObject}}}catch(a){return{outcome:"FAILURE",rawErrorCode:"INTERNAL_ERROR",rawErrorObject:a}}};return a}();g.default=a}),98);
__d("ResumableUploadServiceComet",["CometAsyncFetchError","ConstUriUtils","EventEmitter","Promise","ResumableUploadServiceState.enum","cometAsyncFetch","isStringNullOrEmpty","uuidv4","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h,i="rupload",j="facebook.com";a=function(a){function e(b,d,e,f,g,h,k,l,m,n,o,p,q){var r;r=a.call(this)||this;r.returnFullResponseToClient=!1;r.$ResumableUploadServiceComet$p_1=!1;r.consumer=b;r.accessToken=d;r.sessionKey=c("isStringNullOrEmpty")(e)?c("uuidv4")():e;r.contentKey=f||"";r.contentValue=g||"";r.serviceName=c("isStringNullOrEmpty")(h)?i:h;r.serviceDomain=c("isStringNullOrEmpty")(k)?j:k;r.receiveParameters=l;r.skipOffsetFetching=m;r.thriftParams=n!=null?n:new Map();r.tracingHeaderValue=o;r.customHttpHeaders=p!=null?p:new Map();r.returnFullResponseToClient=q!=null?q:!1;r.$ResumableUploadServiceComet$p_1=!1;return r}babelHelpers.inheritsLoose(e,a);e.create=function(a){return new e(a.consumer,null,a.sessionKey||"",a.contentKey,a.contentValue,a.serviceName,a.serviceDomain,a.receiveParameters,a.skipOffsetFetching,a.thriftParams,a.tracingHeaderValue,a.customHttpHeaders,a.returnFullResponseToClient)};var f=e.prototype;f.$ResumableUploadServiceComet$p_2=function(){var a,b={};if(((a=this.receiveParameters)==null?void 0:a.xpv_asset_id)!=null){b.xpv_asset_id=String((a=this.receiveParameters)==null?void 0:a.xpv_asset_id)}if(((a=this.receiveParameters)==null?void 0:a.is_xpv_single_prod)!=null){b.is_xpv_single_prod=String((a=this.receiveParameters)==null?void 0:a.is_xpv_single_prod)}return b};f.resume=function(a){var e=this;this.$ResumableUploadServiceComet$p_1=!1;var f=this.getServiceName();f=d("ConstUriUtils").getUri("https://"+f+"/"+this.consumer+"/"+this.sessionKey);f!=null&&this.contentKey&&this.contentValue&&(f=f.addQueryParam(this.contentKey,this.contentValue));if(f==null){var g=new Error("ResumableUploadService: Invalid uploadURI");g.stack;throw g}var i=f.toString();g=function(){return c("cometAsyncFetch")(i,{data:{},getFullPayload:!0,method:"GET",requestHeaders:e.$ResumableUploadServiceComet$p_2(),withCredentials:!0})};f=function(b){var d=0;typeof b==="object"&&b!=null&&typeof b.offset==="number"&&(d=b.offset);e.emit(c("ResumableUploadServiceState.enum").START,{offset:d,sessionKey:e.sessionKey});b=e.$ResumableUploadServiceComet$p_2();b["X-Entity-Name"]=encodeURIComponent(a.name);b["X-Entity-Type"]=a.type;b["X-Entity-Length"]=String(a.size);b.Offset=String(d);if(e.receiveParameters){var f=e.receiveParameters;b.start_offset=String(f.start_offset);b.end_offset=String(f.end_offset);b.composer_session_id=String(f.composer_session_id);b.id=String(f.upload_session_id);b.product_media_id=String(f.product_media_id);f.fb_region!=null&&(b["X-FB-Region"]=String(f.fb_region));f.total_file_size!=null&&(b["X-Total-Asset-Size"]=String(f.total_file_size))}e.thriftParams.size>0&&(b["X-Thrift-Params"]=JSON.stringify(Object.fromEntries(e.thriftParams.entries())));e.tracingHeaderValue!=null&&(b["x-fb-product-log"]=e.tracingHeaderValue);if(e.customHttpHeaders.size>0)for(f of e.customHttpHeaders){var g=f[0],h=f[1];b[g]=h}g=new AbortController();e.abortController=g;h=function(b){b=new ProgressEvent("upload-service",{loaded:b.loadedBytes+Number(d),total:a.size});e.emit(c("ResumableUploadServiceState.enum").PROGRESS,b)};return c("cometAsyncFetch")(i,{abortSignal:g.signal,data:{},formData:a.slice(d),getFullPayload:!0,method:"POST",onUploadProgress:h,requestHeaders:b,withCredentials:!0})};var j=function(a){if(a==null){e.emit(c("ResumableUploadServiceState.enum").FAIL,"uploading failed");return}e.returnFullResponseToClient||a.h==null?e.emit(c("ResumableUploadServiceState.enum").SUCCESS,a):e.emit(c("ResumableUploadServiceState.enum").SUCCESS,a.h)},k=function(a){if(e.$ResumableUploadServiceComet$p_1===!0)return;if(a instanceof c("CometAsyncFetchError")){var b={getError:function(){return a.errorCode},getErrorDescription:function(){return a.errorMsg},getErrorDescriptionString:function(){return a.errorMsg},getErrorIsWarning:function(){return!1},getErrorSummary:function(){c("vulture")("J0Lqn8Z6466Pt8wJ4YfCA-z3YN8=");return a.errorType},getPayload:function(){return null},getRequest:function(){return null},getResponseHeader:function(){return a.errorRawResponseHeaders},isBlockedAction:function(){return!1},isSilent:function(){return!1},isTransient:function(){return!0},toError:function(){return a}};e.emit(c("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,b,{method:"POST",offset:0})}else e.emit(c("ResumableUploadServiceState.enum").FAIL,a)};g=this.skipOffsetFetching==!0?(h||(h=b("Promise"))).resolve():g();return g.then(f,k).then(j,k)};f.getServiceName=function(){return this.serviceName+"."+this.serviceDomain};f.cancel=function(){this.$ResumableUploadServiceComet$p_1=!0,this.abortController&&this.abortController.abort(),this.emit(c("ResumableUploadServiceState.enum").CANCEL)};f.emitFileSizeWarning=function(a){this.emit(c("ResumableUploadServiceState.enum").FILE_TOO_LARGE,a)};return e}(c("EventEmitter"));g["default"]=a}),98);
__d("VideoUploadCallbacksMixin",[],(function(a,b,c,d,e,f){"use strict";function g(a){return Array.isArray(a)?a:[a]}a={inform:function(a,b){var c=this.__callbacksByType;if(c==null)return;a=g(a);a.forEach(function(a){var d=c[a];if(d==null)return;d.forEach(function(c){try{c(a,b)}catch(a){}})})},subscribe:function(a,b){var c,d=this.__callbacksByType=(c=this.__callbacksByType)!=null?c:{},e=g(a);e.forEach(function(a){a=d[a]=(a=d[a])!=null?a:[];a.push(b)});var f=!1;return{remove:function(){if(f===!0)return;f=!0;e.forEach(function(a){var c=d[a];if(c==null)return;var e=c.indexOf(b);e!==-1&&c.splice(e,1);c.length===0&&delete d[a]})}}}};e.exports=a}),null);